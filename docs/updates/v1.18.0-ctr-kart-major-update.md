# CTR Kart v1.18.0 - Major Racing Update

**Release Date:** January 4, 2026  
**Version:** 1.18.0

---

## ğŸï¸ Overview

This release brings significant improvements to CTR Kart, focusing on racing physics, visual polish, and overall gameplay feel. The update introduces a realistic curve handling system, improved collision effects, and numerous quality-of-life improvements.

---

## âœ¨ New Features

### ğŸŒ€ Realistic Curve Physics
- **Entry slowdown**: Karts naturally decelerate when entering curves (-15% speed)
- **Exit acceleration**: Boost when exiting curves (+8% speed burst)
- **Straight sections**: Normal speed maintained
- **Maneuverability bonus**: High-maneuver karts handle curves better

### ğŸ’¨ Wall Collision Effects
- **Smoke particles**: 3-5 smoke puffs appear on wall impact
- **Radial gradient**: Gray smoke fading to transparent
- **Sparks underneath**: Original spark effect preserved
- **Proper layering**: Smoke drawn before kart body

### ğŸ”„ Stuck Kart Recovery System
- **Automatic detection**: Tracks continuous wall collision
- **5-second timer**: Triggers respawn after being stuck
- **Recovery benefits**: 
  - Respawn to nearest track point
  - +10 damage heal
  - +0.5 recovery speed boost
- **Smart reset**: Timer resets when driving normally

### ğŸ¨ Visual Improvements
- **Kart preview canvas**: Real kart rendering in configurator (replaces emoji)
- **Track preview cards**: Updated to match in-game rendering
- **Border rendering**: Clean stroke-based borders without artifacts
- **Health bar sync**: Bar width now matches percentage text exactly

---

## âš¡ Performance & Balance

### Speed Adjustments
| Parameter | Before | After | Change |
|-----------|--------|-------|--------|
| Base Speed | 1.8 | 2.0 | +11% |
| Max Speed | 4.0 | 4.5 | +12.5% |
| Speed Multiplier | 0.22 | 0.25 | +13.6% |
| Curve Slowdown | 30% | 12% | -60% penalty |

### Curve Handling
- Sharp curves: 0.88x speed (was 0.70x)
- Maneuverability curve bonus: 0.01 per point
- Exit boost: Up to 1.08x speed

---

## ğŸ› ï¸ Technical Improvements

### Track Rendering (v76 Solution)
```typescript
// Layer 1: Border stroke (wider)
ctx.strokeStyle = style.outerBorderColor;
ctx.lineWidth = trackWidth + 6;
ctx.stroke();

// Layer 2: Track fill (on top)  
ctx.strokeStyle = style.trackColor;
ctx.lineWidth = trackWidth;
ctx.stroke();
```
- Both layers use `lineCap='round'` and `lineJoin='round'`
- Border peeks out 3px on each side
- Clean at all curves and intersections

### Code Quality
- Removed unused variables and functions
- Fixed TypeScript type errors
- Cleaned up ESLint warnings
- Added proper null-safety with `??` operators

---

## ğŸ› Bug Fixes

- **Health bar mismatch**: Fixed bar width not matching percentage text
- **Track border artifacts**: Resolved jagged corners and gaps at intersections
- **Type errors**: Fixed `accent` property compatibility in color selection
- **Array access safety**: Added fallbacks for undefined array elements
- **Maintenance wrapper**: Added `planets` game to maintenance system

---

## ğŸ“ Files Modified

### CTR Kart
- `hooks/useKartGame.ts` - Curve physics, stuck recovery, speed config
- `components/RaceCanvas.tsx` - Smoke effects, track rendering
- `components/GameHUD.tsx` - Health bar fix
- `components/KartConfigurator.tsx` - Canvas kart preview
- `components/CircuitSelector.tsx` - Updated track previews
- `config/kart.config.tsx` - Speed parameters
- `types/kart.types.ts` - wallHitStartTime field
- `page.tsx` - Color handler fix

### Planets Game (Maintenance)
- `components/ChatPanel.tsx` - Unused var fix
- `components/RoundHistory.tsx` - Type fix
- `hooks/usePlanetContract.ts` - Array safety
- `page.tsx` - Maintenance wrapper

### Admin
- `maintenance/types/maintenance.types.ts` - Added 'planets'
- `maintenance/config/maintenance.config.tsx` - Planets config

---

## ğŸ® Gameplay Impact

1. **Faster overall pace**: Base speed increase makes races more exciting
2. **Strategic curves**: Entering/exiting curves now requires skill
3. **Recovery from mistakes**: Stuck karts auto-respawn instead of being trapped
4. **Better feedback**: Wall hits feel impactful with smoke effects
5. **Visual consistency**: Previews match actual in-game rendering

---

## ğŸ”œ Future Considerations

- Acceleration boost on straight exits (additional realism)
- Draft/slipstream visual effects
- Lap time leaderboards
- Custom track styling per circuit

---

## ğŸ“Š Version History

| Version | Date | Highlights |
|---------|------|------------|
| v71 | Jan 4 | Wall smoke effects |
| v72-75 | Jan 4 | Border rendering attempts |
| v76 | Jan 4 | Clean border solution |
| v77 | Jan 4 | Speed balancing |
| v78-80 | Jan 4 | All improvements + fixes |
| **1.18.0** | **Jan 4** | **Production release** |
